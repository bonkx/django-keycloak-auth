name: Docker Image CI

on:
  # push:
  #   branches: ["main"]
  # pull_request:
  #   branches: ["main"]
  workflow_dispatch:

jobs:
  build:
    runs-on:
      - self-hosted
      - 10.101.213.121

    steps:
      - uses: actions/checkout@v3

      - name: Initiate env
        run: |
          cp /opt/django-keycloak-auth/.env pwd/.env

      - name: Build the Docker image
        # run: docker build . --file Dockerfile --tag my-image-name:$(date +%s)
        run: make buildserver

      - name: Run the Docker image
        run: make runserver
